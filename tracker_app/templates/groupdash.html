{% extends "base.html" %}

{% block page_content %}

<!-- https://getbootstrap.com/docs/4.0/components/carousel/ -->
<div id="dateRangeCarousel" class="carousel slide" data-ride="carousel" data-interval="0"> 
    <!-- Carousel Indicators -->
    <ol class="carousel-indicators">
        {% for w in weeks %}
            {% if w.isalltime %}
                <li data-target="#dateRangeCarousel" data-slide-to="{{ forloop.counter0 }}" class="active" style="filter: invert(100%);"></li>
            {% else %}
                <li data-target="#dateRangeCarousel" data-slide-to="{{ forloop.counter0 }}" style="filter: invert(100%);"></li>
            {% endif %}
        {% endfor %}
    </ol>


    <!-- Carousel Content -->
    {% if not is_owner %}
    <div class="carousel-inner" style="max-height: 72vh; min-height: 72vh; overflow-y: scroll; overflow-x: auto; margin-top: 2vh;">
    {% else %}
    <div class="carousel-inner" style="max-height: 90vh; min-height: 90vh; overflow-y: scroll; overflow-x: auto; margin-top: 2vh;">
    {% endif %}

        {% for w in weeks %}

        <!--Does not show w weeks data unless time log is submitted or user is not a tutor-->
        

            <!-- Submit Time Log to Tutor Button -->
            {% if is_leader %}
            <div class="navbar-nav" style="display: block; position: absolute; right: 84px; top: 24px; margin: 0px; padding: 0px;">
                <button type="button" class="btn btn-primary" style= "background-color: var(--accent5);" onclick="submitTimeLog{{forloop.counter0}}(w)">Submit Time Log</button>
            </div>
            {% endif %}

            <!--function to change submitted value-->
            <script type="text/javascript">
                function submitTimeLog{{forloop.counter0}}(w)
                {
                w.submitted = True;
                }
            </script>


            {% if w.isalltime %}
            <div class="carousel-item active">
            {% else %}
            <div class="carousel-item">
            {% endif %}

                <!-- Date Range Heading -->
                <div class="row justify-content-center group-content" style="margin-bottom: 4vh;">
                    <h3> {{ w.simplename }} - {% if w.submitted %} Submitted {% else %} Not Submitted {% endif %} </h3>
                </div>

                <!-- Charts - for group -->
                <!-- only displays charts to tutor if time log summitted for that week-->
                {% if is_owner or user.is_superuser or is_leader %}
                {% if is_staff == True and w.submitted == True %}
                    {% include "groupchart.html" with members=w.members %}
                    {% include "groupTaskChart.html" with members=w.members %}
                {% elif is_staff == False %}
                    {% include "groupchart.html" with members=w.members %}
                    {% include "groupTaskChart.html" with members=w.members %}
                {% endif %}
                {% endif %}
                
                <!-- Charts - for individual -->
                <!-- only displays chart to tutor if time log summitted for that week-->
                {% if active_member is not None %}
                {% if is_staff == True and w.submitted == True %}
                    {% include "taskchart.html" with members=w.members%}
                {% elif is_staff == False %}
                    {% include "taskchart.html" with members=w.members%}
                {% endif %}
                {% endif %}
                
                <!-- Members Table -->
                <!-- only displays table to tutor if time log summitted for that week-->
                {% if is_staff == True and w.submitted == True %}
                    {% include "timetable.html" with members=w.members%}
                {% elif is_staff == False %}
                    {% include "timetable.html" with members=w.members%}
                {% endif %}
                <!-- Whitespace -->
                <div class="row justify-content-center" style="min-height: 40px;"></div>
            </div>
        
        {% endfor %}
    </div>

    <!-- Next/Prev Buttons -->
    <a class="carousel-control-prev" href="#dateRangeCarousel" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true" style="filter: invert(100%);"> </span>
        <span class="sr-only">Previous</span>
    </a>

    <a class="carousel-control-next" href="#dateRangeCarousel" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true" style="filter: invert(100%);"> </span>
        <span class="sr-only">Next</span>
    </a>
</div>

<!--form to create new time/task logs
    Decided to go with a different approach:

    * user clicks a button (New Log) which takes them to logging a MemberEntry
    * if the Taskcategory isnt available in the dropdown of the MemberEntry form they have the option of making a new one
    * if they make a new one, this takes them to the TaskCategory form.

    None of the above has been implemented and only the New Log button should belong in this template. -->
    
{% if not is_owner %}
{% if active_member is None  or  active_member.person == request.user %}
<hr>
<div class="row justify-content-center">
    <h5 style="color: var(--accent1); padding-bottom: 2vh;">Log Time</h5>
</div>

<div class="row justify-content-center">
    <form method="POST" name="logtime" id="logtime"> {% csrf_token %}
        <label for="hours">Hours</label>
        <input name="hours" type="number" id="hours" min="0.5" step="0.5">

        <label for="task">Task</label>
        <select name="task" id="task">
            {% for t in tasks %}
                <option value="{{ t.categoryName }}">{{t.categoryName}}</option>
            {% endfor %}
        </select>

        <input type="submit">
    </form>
</div>
{% endif %}
{% endif %}

{% endblock %}